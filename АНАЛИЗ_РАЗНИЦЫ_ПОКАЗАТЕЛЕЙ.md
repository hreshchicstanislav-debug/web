# Анализ разницы между "Сфоткано, но не обработано" и "Предстоит отснять"

## Краткий ответ

**НЕТ, они НЕ дублируют друг друга.** Это два разных показателя с разными целями:

1. **"Предстоит отснять"** — плановый показатель (что нужно сделать по дедлайну)
2. **"Сфоткано, но не обработано"** — фактический показатель (что уже начато, но не завершено)

## Детальное сравнение

### 1. "Предстоит отснять" (`to_shoot_qty`)

**Определение:** Плановый объем работы, которую нужно выполнить в эту неделю по дедлайну.

**Формула:**
```sql
Сумма q для задач, где:
- due_on попадает в диапазон [weekStartStr, weekEndStr] (дедлайн в текущей неделе)
- q > 0
- completed != true (задача не завершена)
```

**Ключевые особенности:**
- ✅ Определяется по **плановой дате** (`due_on`)
- ✅ Включает задачи, которые **еще не начаты** (`shot_at` может быть `NULL`)
- ✅ Включает задачи, которые **уже начаты**, но не завершены
- ✅ Это **плановый показатель** — показывает объем работы по плану

**Примеры задач:**
- Задача с дедлайном в понедельник, работа еще не начата → ✅ входит
- Задача с дедлайном в среду, уже сфоткана, но не обработана → ✅ входит
- Задача с дедлайном в пятницу, уже обработана → ❌ не входит (completed = true)

---

### 2. "Сфоткано, но не обработано" (`shot_not_processed_qty`)

**Определение:** Фактический объем работы, которая уже начата (сфотографирована) на этой неделе, но еще не завершена (не обработана).

**Формула:**
```sql
Сумма q для задач, где:
- week_shot = weekStartStr (сфоткано на этой неделе)
- shot_at IS NOT NULL (есть дата съёмки)
- processed_at IS NULL (нет даты обработки)
- completed != true (задача не завершена)
- q > 0
```

**Ключевые особенности:**
- ✅ Определяется по **фактической дате** (`week_shot` на основе `shot_at`)
- ✅ Включает только задачи, которые **уже начаты** (`shot_at IS NOT NULL`)
- ✅ Включает задачи, которые **уже начаты**, но не завершены
- ✅ Это **фактический показатель** — показывает текущий статус работы

**Примеры задач:**
- Задача сфоткана в понедельник, но не обработана → ✅ входит
- Задача сфоткана в среду, дедлайн был на прошлой неделе → ✅ входит (если week_shot = текущая неделя)
- Задача сфоткана в пятницу, но уже обработана → ❌ не входит (processed_at заполнено)

---

## Могут ли они пересекаться?

**ДА, могут!** Задача может попадать в оба показателя одновременно, если:

1. Задача имеет дедлайн в текущей неделе (`due_on` в диапазоне недели)
2. Задача сфоткана на этой неделе (`week_shot = текущая неделя`)
3. Задача еще не обработана (`processed_at IS NULL`)
4. Задача не завершена (`completed != true`)

**Пример:**
- Задача: "Сфоткать товар X"
- `due_on` = 2025-12-10 (вторник текущей недели)
- `shot_at` = 2025-12-09 (понедельник текущей недели)
- `processed_at` = NULL
- `completed` = false

→ Эта задача попадает в **ОБА** показателя:
- ✅ "Предстоит отснять" (дедлайн в этой неделе, не завершена)
- ✅ "Сфоткано, но не обработано" (сфоткана на этой неделе, не обработана)

---

## В чем принципиальная разница?

| Критерий | "Предстоит отснять" | "Сфоткано, но не обработано" |
|----------|---------------------|------------------------------|
| **Тип показателя** | Плановый | Фактический |
| **Определение недели** | По `due_on` (дедлайн) | По `week_shot` (факт съёмки) |
| **Статус работы** | Может быть не начата | Уже начата (есть `shot_at`) |
| **Цель** | Показать объем работы по плану | Показать текущий статус работы |
| **Использование** | Планирование нагрузки | Операционный контроль |

---

## Примеры различий

### Пример 1: Задача еще не начата

**Задача:**
- `due_on` = 2025-12-10 (вторник текущей недели)
- `shot_at` = NULL
- `processed_at` = NULL
- `completed` = false

**Результат:**
- ✅ "Предстоит отснять" — **входит** (дедлайн в этой неделе, не завершена)
- ❌ "Сфоткано, но не обработано" — **не входит** (нет `shot_at`)

---

### Пример 2: Задача сфоткана, но дедлайн был на прошлой неделе

**Задача:**
- `due_on` = 2025-12-03 (вторник прошлой недели)
- `shot_at` = 2025-12-09 (понедельник текущей недели)
- `processed_at` = NULL
- `completed` = false

**Результат:**
- ❌ "Предстоит отснять" — **не входит** (дедлайн не в текущей неделе)
- ✅ "Сфоткано, но не обработано" — **входит** (сфоткана на этой неделе, не обработана)

---

### Пример 3: Задача сфоткана и обработана

**Задача:**
- `due_on` = 2025-12-10 (вторник текущей недели)
- `shot_at` = 2025-12-09 (понедельник текущей недели)
- `processed_at` = 2025-12-09 (понедельник текущей недели)
- `completed` = true

**Результат:**
- ❌ "Предстоит отснять" — **не входит** (завершена)
- ❌ "Сфоткано, но не обработано" — **не входит** (уже обработана)

---

## Вывод

**Эти показатели НЕ дублируют друг друга**, они дополняют друг друга:

1. **"Предстоит отснять"** — показывает **плановый объем** работы на неделю (по дедлайнам)
2. **"Сфоткано, но не обработано"** — показывает **фактический статус** работы (что уже начато, но не завершено)

Они могут пересекаться, но это нормально — одна и та же задача может быть и в плане (по дедлайну), и в факте (по статусу работы).

---

## Как проверить на реальных данных?

Выполните SQL-скрипт `check_tasks_difference.sql` в Supabase SQL Editor. Он покажет:
1. Сколько задач в "Предстоит отснять"
2. Сколько задач в "Сфоткано, но не обработано"
3. Сколько задач попадают в оба показателя (пересечение)
4. Сколько задач только в "Предстоит отснять"
5. Сколько задач только в "Сфоткано, но не обработано"

