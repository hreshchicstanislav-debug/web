# Инструкция по настройке Supabase для загрузки фотографий

## Шаг 1: Добавить поле photo_url в таблицу

1. Откройте Supabase Dashboard: https://supabase.com/dashboard
2. Выберите ваш проект
3. Перейдите в **SQL Editor** (SQL редактор)
4. Выполните следующий SQL запрос:

```sql
-- Добавить поле photo_url в таблицу time_tracks
ALTER TABLE time_tracks 
ADD COLUMN IF NOT EXISTS photo_url TEXT;
```

## Шаг 2: Создать Storage Bucket для фотографий

1. В Supabase Dashboard перейдите в **Storage** (в левом меню)
2. Нажмите **New bucket** (Создать новый bucket)
3. Введите имя bucket: **`photos`** (именно это имя, без кавычек)
4. Выберите **Public bucket** (публичный bucket) - это позволит получать публичные URL для фотографий
5. Нажмите **Create bucket** (Создать)

## Шаг 3: Настроить политики доступа (RLS) для Storage

1. После создания bucket, нажмите на него (bucket "photos")
2. Перейдите на вкладку **Policies** (Политики)
3. Нажмите **New Policy** (Новая политика)
4. Выберите **For full customization** (Для полной настройки)
5. Введите имя политики: **Allow upload photos** (Разрешить загрузку фотографий)
6. В поле **Allowed operation** выберите **INSERT** (Вставка)
7. В поле **Policy definition** введите:

```sql
bucket_id = 'photos'
```

8. Нажмите **Review** (Проверить), затем **Save policy** (Сохранить политику)

9. Создайте еще одну политику для чтения:
   - Имя: **Allow read photos** (Разрешить чтение фотографий)
   - Операция: **SELECT** (Выборка)
   - Policy definition:

```sql
bucket_id = 'photos'
```

10. Нажмите **Review**, затем **Save policy**

## Шаг 4: Проверка настройки

После выполнения всех шагов:

1. Убедитесь, что bucket "photos" создан и помечен как **Public**
2. Убедитесь, что созданы две политики (для INSERT и SELECT)
3. В приложении нажмите кнопку "Добавить фото" и попробуйте загрузить фотографию

## Важные замечания

- Bucket должен быть **публичным** (Public), чтобы можно было получать публичные URL
- Имя bucket должно быть точно **`photos`** (как указано в коде)
- Если вы изменили имя bucket в коде, обновите константу `STORAGE_BUCKET` в файле `app.js`

## Если что-то не работает

1. Проверьте консоль браузера (F12) на наличие ошибок
2. Убедитесь, что bucket создан и является публичным
3. Убедитесь, что политики доступа настроены правильно
4. Проверьте, что поле `photo_url` добавлено в таблицу `time_tracks`

