# Mobile UI Reference – `#/tasks`

Документ описывает фактическое состояние мобильного интерфейса вкладки «Задачи» (ширина 360–430 px) в репозитории `web/` после последнего обновления.

---

## 1. Общая структура страницы
- Рендер формируется функцией `renderTasks()` (`app.js`), которая целиком подменяет содержимое контейнера `#app`.
- Порядок блоков (в том виде, как они попадают в DOM):
  1. Заголовок `h1` «Задачи Asana».
  2. Сетка KPI-карточек `#tasksGrid` (5 карточек, каждая — отдельный `div` с инлайновыми стилями).
  3. Панель вторичных показателей `#secondaryMetrics`.
  4. Кнопка «Обновить данные» и поясняющий текст.
  5. Кнопка «Показать подробности».
  6. Контейнер `#tasksDetailsContainer` с вложенным `#tasksDetailsList`, в который подставляется таблица деталей.
- Выше по DOM остаётся глобальный `header` с навигацией (`#tabMe`, `#tabBoss`, `#tabTasks`). Все табы отображаются и на мобильном.

## 2. Поведение блоков на мобильном
- Глобальные отступы: в `index.html` определены media‑query блоки (`@media (max-width: 900px)`, `720px`, `768px`, `480px`) которые постепенно уменьшают `body` padding до 8–12 px и уменьшают `h1`.
- Навигация (`nav a`) при ширине ≤ 720 px растягивается на всю ширину (`flex: 1 0 100%`) и выравнивает текст по левому краю.
- Контейнеры KPI и вторичных показателей используют фиксированные паддинги/шрифты из инлайн‑стилей; на мобильных шрифты автоматически уменьшаются только там, где предусмотрены media‑query переопределения.

## 3. KPI‑карточки
- Базовая сетка: `<div id="tasksGrid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;">`.
- Карточки №1–5 содержат инлайн‑стили: фон, рамка, скругления, `font-size` 24 px для основного числа, подзаголовки 10–12 px.
- Media‑queries:
  - `@media (max-width: 720px)` (строки `253:268:index.html`) принудительно переводит сетку в одну колонку (`grid-template-columns: minmax(0, 1fr)`), увеличивает gap до 12 px и уменьшает padding карточек до 12 px.
  - Затем, ниже по файлу, существует более поздний блок `@media (max-width: 768px)` (`827:845:index.html`), который снова задаёт `grid-template-columns: repeat(2, 1fr)` с меньшими шрифтами, перекрывая правило 720 px. Итог: при ширинах 360–430 px карточки располагаются в два столбца по две карточки в строке (пятая карточка переходит на отдельную строку). Это поведение критично зависимо от порядка CSS.
  - Для ≤ 480 px (`895:910:index.html`) правило повторяется: сетка жёстко остаётся двухколоночной, шрифт заголовков 10 px, значений 18 px.
- Текст в карточках не переносится вручную; браузер переносит только по пробелам, поэтому подписи вроде «Переработка с прошлой недели» (10 px) занимают всю ширину карточки.

## 4. Кнопки «Обновить данные» и «Показать подробности»
- Обе кнопки создаются как `<button class="btn" style="width: 100%; ...>`, поэтому на мобильных всегда растягиваются на полную ширину контейнера.
- Минимальная высота кнопок управляется глобально (44 px).
- Текст не переносится строкой, но из‑за ширины 100 % помещается целиком; при очень узких экранах (≤ 320 px) возможен перенос, однако в диапазоне 360–430 px текст остаётся в одну строку.
- Между кнопками остаётся вертикальный интервал 16 px (инлайн‑margin контейнеров).

## 5. Секция «Показать подробности»
- Контейнер `#tasksDetailsContainer` имеет класс `tasks-details-container`, который анимирует раскрытие: `max-height: 0 / 2000px`, `opacity` 0→1 (см. `599:610:index.html`).
- Внутри `#tasksDetailsList` рендерится таблица с `<table>` и `thead`/`tbody`. Колонки: «Задача», `Q`, «Товар», «Статус», «Сфоткал», «Обработал», «Дедлайн` (см. `2497:2506:app.js`).
- Каждая ячейка имеет инлайн‑паддинги по 10 px, шрифты 12 px (для служебной строки 10 px). Значения `project_gid`/`assignee_gid` выводятся в блоке `<div>` в каждой строке.
- Горизонтальный скролл: у `#tasksDetailsList` задан `overflow-x: auto` в глобальном CSS, поэтому на ширинах > 720 px таблица прокручивается горизонтально при нехватке места.
- При ширине ≤ 720 px таблица превращается в карточный список:
  - `#tasksDetailsList thead { display: none; }`
  - `tbody` становится блочным, каждая строка — отдельный `div` с рамкой и паддингом (`231:314:index.html`).
  - `td` переключаются в `display: flex` и получают `data-label` из `app.js`, который вывели в последних правках (см. участок `2532:2543:app.js`). Псевдоэлемент `::before` подставляет название поля.
  - Границы и фоны строк управляются inline (чередование фона, красный фон для Q‑ошибок), но на мобильной версии красная полоса остаётся благодаря `border-left`.

## 6. CSS‑правила для мобильного режима
- Основные media‑queries:
  - `@media (max-width: 900px)` — уменьшает общей padding и перестраивает `header`.
  - `@media (max-width: 720px)` — задаёт 100 % ширину для элементов навигации, переводит `#tasksGrid` в одну колонку, уменьшает `#secondaryMetrics`, включает карточный режим таблицы.
  - `@media (max-width: 768px)` и `@media (max-width: 480px)` (расположены ниже в файле) переопределяют многие параметры, в частности принудительно делают `#tasksGrid` двухколоночным, уменьшают шрифты KPI до 10–11 px.
  - У деталей задач дополнительный набор правил (`#tasksDetailsList td::before`, `display:block`) работает только внутри блока `@media (max-width: 720px)`.
- Используемые layout‑техники:
  - Flex для навигации, вторичных метрик и ячеек в мобильной таблице.
  - CSS Grid для KPI‑карточек.
  - `overflow-x: auto` и `border-collapse` для таблицы в десктопном режиме.
  - `max-height` + `transition` для раскрытия секции.

## 7. Inline‑стили и их влияние
- Практически все KPI‑карточки и кнопки используют инлайн‑стили (цвета, паддинги, шрифты). Примеры:
  - Карточка «Сделано»: `style="background: #e8f5e9; border: 1px solid #4caf50; border-radius: 8px; padding: 12px;"` и `font-size: 24px` для значения (`2055:2067:app.js`).
  - Кнопки `#refreshStats` / `#showDetails`: `style="width: 100%; position: relative; z-index: 1; cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent;"`.
  - Строки таблицы деталей: набор инлайн‑стилей для фона, рамок и размера шрифта (`2531:2544:app.js`).
- Инлайн‑переопределения затрудняют дальнейшую адаптацию: ни `style` ни классами не управляются централизованно, поэтому изменения нужно вносить в JS.

## 8. Текущие проблемы мобильного UI
1. **Конфликтующие media‑queries.** Блок на 768 px расположен ниже блока на 720 px, поэтому на ширинах 360–430 px действует именно двухколоночная сетка KPI. Пятая карточка оказывается одиночной строкой, а высота карточек неравномерная.
2. **Очень мелкие шрифты.** В карточках используются значения 10–12 px, а в детальной секции — 10 px для служебного текста. Для мобильных устройств с ретина‑экранами это сложно читается.
3. **Слишком длинные подписи.** Подпись «Переработка с прошлой недели» при двухколоночной сетке упирается в границы и визуально «ломает» карточку — текста много, шрифт мал.
4. **Неравномерные отступы у вторичных метрик.** `#secondaryMetrics` уменьшает шрифт до 12 px, но строки остаются широкими и без переносов; на мелких экранах числа прилипают к правому краю.
5. **Детальная таблица на мобильном превращается в карточки, но текстовые подписи для `project_gid` / `assignee_gid` остаются в 10 px и выглядят как «служебный лог».**
6. **Красная подсветка Q‑ошибок задаётся инлайн и на мобильном занимает всю ширину карточки, что делает текст трудночитаемым (красный фон, чёрный текст).**
7. **Анимация раскрытия (`max-height: 2000px`) может обрезать длинные списки: при большом количестве задач требуется скролл внутри контейнера, но высота фиксирована.**
8. **Навигация по вкладкам занимает всю ширину, но при трёх кнопках на маленьком экране скролл страницы увеличивается из‑за больших верхних отступов (главный `header` всё равно содержит padding 16 px).**

## 9. Критические проблемы
1. **Несогласованная сетка KPI**: два разных media‑query блокa управляют `#tasksGrid`, итог — жёсткая двухколоночная сетка даже на очень узких экранах, что приводит к переполнению текста и крошечным шрифтам.
2. **Чрезмерно мелкие размеры шрифтов** (10–11 px) в ключевых местах (подписи карточек, строки деталей), что нарушает требования по доступности.
3. **Детальная таблица содержит служебную информацию (`project_gid`, `assignee_gid`) мелким серым текстом прямо под названием задачи — на мобильном это выглядит как «ломаный» блок и затрудняет чтение основного содержания.
4. **Раскрывающийся блок ограничен `max-height: 2000px`**, поэтому длинные списки задач могут обрезаться и становятся недоступными без изменения CSS.

