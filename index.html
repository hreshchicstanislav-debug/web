<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TimeTrack</title>
  <link rel="icon" type="image/png" href="/icon-192.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#2196F3">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="TimeTrack">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin:0 auto; padding:16px; max-width:740px}
    header{display:flex; gap:12px; align-items:center; margin-bottom:12px; flex-wrap:wrap}
    a{color:inherit; text-decoration:none}
    nav{display:flex; gap:8px; flex-wrap:wrap}
    nav a{padding:8px 12px; border:1px solid #ddd; border-radius:8px; min-height:44px; display:flex; align-items:center; justify-content:center}
    nav a.active{background:#f5f5f5}
    h1{font-size:20px; margin:12px 0}
    label{display:block; margin:12px 0 4px}
    input, textarea, button, select{font-size:16px; padding:10px; border:1px solid #ccc; border-radius:8px; width:100%; min-height:44px; box-sizing:border-box}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .row>*{flex:1; min-width:0}
    .muted{color:#666; font-size:14px}
    .list{border:1px dashed #ddd; padding:10px; border-radius:8px}
    .btn{cursor:pointer; min-height:44px; touch-action:manipulation}
    .right{display:flex; justify-content:flex-end; gap:8px; flex-wrap:wrap}
    .calendar{display:grid; grid-template-columns:repeat(7,1fr); gap:4px}
    .cell{border:1px solid #ddd; padding:8px 4px; border-radius:8px; text-align:center; cursor:pointer; user-select:none; position:relative; min-height:44px; display:flex; align-items:center; justify-content:center; font-size:14px}
    .cell:hover{background:#f0f0f0}
    .cell:active{background:#e0e0e0}
    .cell-photo-icon{position:absolute; bottom:2px; right:2px; width:16px; height:16px; color:#2196F3; opacity:0.8}
    .cell-photo-icon svg{width:100%; height:100%}
    .time-wrapper{display:flex; align-items:center; gap:8px}
    .time-wrapper input{flex:1; min-width:0}
    .checkmark{display:none; color:#28a745; font-size:24px; line-height:1}
    .checkmark.visible{display:inline-block}
    .week-view{display:flex; flex-direction:column; gap:8px}
    .day-card{border:1px solid #ddd; border-radius:8px; padding:12px; cursor:pointer; background:#fff}
    .day-card:hover{background:#f9f9f9}
    .day-card-static{border:1px solid #ddd; border-radius:8px; padding:12px; background:#fff; cursor:default}
    .day-card-static:hover{background:#fff}
    .day-header{font-weight:bold; margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid #eee}
    .day-header.today{color:#2196F3}
    .day-content{font-size:14px; line-height:1.6}
    .day-content>div{margin:4px 0}
    .modal-back{position:fixed; inset:0; background:rgba(0,0,0,0.25); display:none; align-items:center; justify-content:center; z-index:1000; padding:16px; box-sizing:border-box}
    .modal{background:#fff; padding:16px; border-radius:12px; width:100%; max-width:520px; max-height:90vh; overflow-y:auto; box-sizing:border-box}
    .modal h3{margin-top:0}
    .photo-toggle-btn{background:#f5f5f5; border:1px solid #ddd; padding:10px 16px; border-radius:6px; cursor:pointer; margin-top:12px; font-size:14px; transition:background 0.2s; min-height:44px; width:100%; box-sizing:border-box; touch-action:manipulation}
    .photo-toggle-btn:hover{background:#e9e9e9}
    .photo-toggle-btn:active{background:#ddd}
    .photo-container{max-height:0; overflow:hidden; transition:max-height 0.3s ease-out; margin-top:12px}
    .photo-container.expanded{max-height:500px}
    .photo-placeholder{width:200px; height:150px; background:#f0f0f0; border:2px dashed #ccc; border-radius:8px; display:flex; align-items:center; justify-content:center; margin:12px auto; color:#999}
    .photo-placeholder svg{width:48px; height:48px}
    .photo-thumbnail{max-width:200px; max-height:150px; border-radius:8px; cursor:pointer; display:block; margin:12px auto; border:1px solid #ddd; transition:transform 0.2s; touch-action:manipulation}
    .photo-thumbnail:hover{transform:scale(1.05)}
    .photo-thumbnail:active{transform:scale(0.98)}
    .lightbox{position:fixed; inset:0; background:rgba(0,0,0,0.95); display:none; align-items:center; justify-content:center; z-index:2000; cursor:pointer; padding:16px; box-sizing:border-box}
    .lightbox.active{display:flex}
    .lightbox img{max-width:100%; max-height:100%; object-fit:contain; border-radius:8px}
    .lightbox-close{position:absolute; top:16px; right:16px; color:#fff; font-size:32px; cursor:pointer; background:rgba(0,0,0,0.5); width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; line-height:1; touch-action:manipulation}
    
    /* Мобильные устройства */
    @media (max-width: 768px) {
      body{padding:12px}
      header{margin-bottom:16px}
      nav{width:100%}
      nav a{flex:1; min-width:120px}
      h1{font-size:18px; margin:8px 0}
      input, textarea, button, select{font-size:16px; padding:12px}
      .row{flex-direction:column; gap:8px}
      .row>*{width:100%}
      .calendar{gap:3px}
      .cell{padding:6px 2px; font-size:12px; min-height:40px}
      .cell-photo-icon{width:14px; height:14px; bottom:1px; right:1px}
      .day-card, .day-card-static{padding:10px}
      .day-content{font-size:13px}
      .modal-back{padding:8px}
      .modal{padding:12px; border-radius:8px}
      .modal h3{font-size:18px}
      .photo-placeholder{width:100%; max-width:200px; height:150px}
      .photo-thumbnail{max-width:100%; width:100%}
      .lightbox-close{top:12px; right:12px; width:40px; height:40px; font-size:28px}
    }
    
    /* Очень маленькие экраны */
    @media (max-width: 480px) {
      body{padding:8px}
      nav a{padding:10px 8px; font-size:14px; min-width:100px}
      h1{font-size:16px}
      .calendar{gap:2px}
      .cell{padding:4px 1px; font-size:11px; min-height:36px}
      .cell-photo-icon{width:12px; height:12px}
      .day-card, .day-card-static{padding:8px}
      .day-content{font-size:12px}
      .modal{padding:10px}
      .modal h3{font-size:16px}
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="#/me" id="tabMe">Мой экран</a>
      <a href="#/boss" id="tabBoss">Экран начальника</a>
    </nav>
  </header>

  <main id="app"></main>

  <!-- Modal -->
  <div class="modal-back" id="modalBack">
    <div class="modal" role="dialog" aria-modal="true">
      <h3 id="modalTitle">Отчёт</h3>
      <pre id="modalBody" style="white-space:pre-wrap"></pre>
      <div id="photoSection" style="display:none;">
        <button class="photo-toggle-btn" id="photoToggleBtn">Показать фото</button>
        <div class="photo-container" id="photoContainer">
          <div id="photoContent"></div>
        </div>
      </div>
      <div class="right">
        <button class="btn" id="modalClose">Закрыть</button>
      </div>
    </div>
  </div>

  <!-- Lightbox для полноэкранного просмотра фото -->
  <div class="lightbox" id="lightbox">
    <span class="lightbox-close" id="lightboxClose">&times;</span>
    <img id="lightboxImage" src="" alt="Фото">
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="app.js"></script>
</body>
</html>
